"use strict";(self["webpackChunkOsboha180"]=self["webpackChunkOsboha180"]||[]).push([[3272],{8417:function(t,e,s){var a=s(24150),o=s(66252),n=s(79940);class i{async create(t){const e=new FormData;e.append("body",t.body),e.append("type",t.type),e.append("timeline_id",t.timeline_id),t.media&&t.media.forEach((t=>{e.append("media[]",t)})),t.tags&&t.tags.forEach((t=>{e.append("tags[]",t)})),t.votes&&t.votes.forEach((t=>{e.append("votes[]",t)}));try{const t=await a.hi.post("/posts",e,{headers:{"Content-type":"multipart/form-data"}});return t.data}catch(s){(0,o.S3)(s)}}async delete(t){try{const e=await a.hi["delete"](`/posts/${t}`);return e.data}catch(e){(0,o.S3)(e)}}async getPostById(t){try{const e=await a.hi.get(`/posts/${t}`);return e.data}catch(e){(0,n.F)(e,"PostService.getPostById")}}async updatePostById(t,e,s,o,n){const i=new FormData;i.append("image",n),i.append("type",s),i.append("timeline_id",o),i.append("body",t),i.append("user_id",e);try{return await a.hi.post("/post/update",{formData:i})}catch(r){return r}}async getPostsForMainPage(t){try{const e=await a.hi.get(`/posts/home?page=${t}`);return e.data}catch(e){(0,o.S3)(e)}}async postsByTimelineId(t,e){try{const s=await a.hi.get(`/posts/timeline/${t}?page=${e}`);return s.data}catch(s){(0,o.S3)(s)}}async getAnnouncements(t){try{const e=await a.hi.get(`/posts/announcements?page=${t}`);return e.data}catch(e){(0,o.S3)(e)}}async getSupportPosts(t){try{const e=await a.hi.get(`/posts/support?page=${t}`);return e.data}catch(e){(0,o.S3)(e)}}async contolComments(t){try{const e=await a.hi.patch(`/posts/${t}/control-comments`);return e.data}catch(e){(0,o.S3)(e)}}async pinPost(t){try{const e=await a.hi.patch(`/posts/pin/${t}`);return e.data}catch(e){(0,o.S3)(e)}}async getLastSupportPost(){try{const t=await a.hi.get("/posts/support/latest");return t.data}catch(t){(0,o.S3)(t)}}async getPendingPosts(t,e=""){try{const s=await a.hi.get(`/posts/pending/timeline/${t}/${e}`);return s.data}catch(s){(0,n.F)(s,"PostService.getPendingPosts")}}async acceptPost(t){try{const e=await a.hi.patch(`/posts/accept/${t}`);return e.data}catch(e){(0,o.S3)(e)}}async declinePost(t){try{const e=await a.hi.patch(`/posts/decline/${t}`);return e.data}catch(e){(0,o.S3)(e)}}}e["Z"]=new i},12174:function(t,e,s){var a=s(66252),o=s(24150);class n{async create(t){try{const e=await o.hi.post("/poll-votes",t);return e.data}catch(e){(0,a.S3)(e)}}async getPostVotesUsers(t,e=""){try{const s=await o.hi.get(`/poll-votes/posts/${t}/users/${e}`);return s.data}catch(s){(0,a.S3)(s)}}}e["Z"]=new n},79940:function(t,e,s){s.d(e,{F:function(){return o}});s(57658);var a=s(1120);function o(t,e=""){throw console.log(`[ERROR] ${e} =>`,t.response.data),404===t.response.data.statusCode?a.Z.push({name:"NotFound"}):403===t.response.data.statusCode&&a.Z.push({name:"NotAuthorized"}),t}},26212:function(t,e,s){s.d(e,{Z:function(){return _}});var a=s(66252),o=s(3577),n=s(49963);const i={class:"mt-3"},r=["innerHTML"],l={key:0,class:"mt-3"},d={class:"poll-input d-flex justify-content-around align-items-center w-100 h-100"},c=["id","value"],p=["for"],u={class:"me-2 text-primary bold-600"};function g(t,e,s,g,h,m){const y=(0,a.up)("progressbar");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",i,[(0,a._)("p",{style:{"white-space":"pre-wrap",direction:"rtl"},innerHTML:m.urlifyFn(m.post.body)},null,8,r)]),m.post.pollOptions?.length?((0,a.wg)(),(0,a.iD)("div",l,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.post.pollOptions,(t=>((0,a.wg)(),(0,a.iD)("div",{class:"progress my-2 border border-light rounded bg-transparent",key:t.id},[(0,a.Wm)(y,{style:(0,o.j5)({width:m.getOptionVotesPercentage(t.id)}),class:"progress-bar",className:"rounded","aria-valuemin":"0","aria-valuemax":"100"},null,8,["style"]),(0,a._)("div",d,[(0,a.wy)((0,a._)("input",{type:"radio",id:t.id,value:t.id,"onUpdate:modelValue":e[0]||(e[0]=t=>h.choosedOption=t),class:"ms-1 mt-0",onChange:e[1]||(e[1]=(...t)=>m.vote&&m.vote(...t))},null,40,c),[[n.G2,h.choosedOption]]),(0,a._)("label",{for:t.id,class:"form-check-label flex-grow-1 text-truncate ms-2 align-right"},(0,o.zw)(t.option),9,p),(0,a._)("span",u,(0,o.zw)(m.getOptionVotesPercentage(t.id)),1)])])))),128))])):(0,a.kq)("",!0)],64)}var h=s(12174),m=s(8209),y={name:"PostBody",inject:{voteOnPost:{default:()=>{}},post:{required:!0}},data(){return{choosedOption:"",errorMessage:""}},mounted(){this.post.pollOptions.length>0&&(this.choosedOption=this.getSelectedOptionId())},methods:{async vote(){const t={option_id:this.choosedOption,post_id:this.post.id};try{const e=await h.Z.create(t);if(200!==e.statusCode)return void m.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error");const s=e.data;if(!s)return;const a=this.getSelectedOptionId();this.voteOnPost({option_id:this.choosedOption,post_id:this.post.id,old_option_id:a,status:s})}catch(e){return console.log("[vote error]",e),this.choosedOption="",e.response?.data?.message?void m.Z.toggleToast(e.response.data.message,"error"):void m.Z.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}},getOptionVotesPercentage(t){const e=this.post.votes_count,s=this.post.pollOptions.find((e=>e.id===t)).votes_count;if(0===e)return"0%";const a=Math.round(s/e*100);return`${a}%`},getSelectedOptionId(){const t=this.post.pollOptions.find((t=>!0===t.selected_by_user));return t?t.id:""},urlifyFn(t){let e=/(https?:\/\/[^\s]+)/g;return t.replace(e,(function(t){return'<a href="'+t+'"  target="_blank" direction: rtl;">'+t+"</a>"}))}}},w=s(83744);const f=(0,w.Z)(y,[["render",g],["__scopeId","data-v-b57502a0"]]);var _=f},89433:function(t,e,s){s.d(e,{Z:function(){return Y}});var a=s(66252),o=s(3577),n=s(49963);const i=t=>((0,a.dD)("data-v-881e41a6"),t=t(),(0,a.Cn)(),t),r={key:0,class:"user-post"},l={class:"row g-2"},d=["onClick"],c=["src"],p={key:0,class:"overlay",role:"button"},u=i((()=>(0,a._)("span",{class:"material-symbols-outlined"}," add ",-1))),g=i((()=>(0,a._)("span",{class:"ms-1"}," المزيد",-1)));function h(t,e,s,i,h,m){const y=(0,a.up)("PostMediaModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[m.slicedMedia?((0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("div",l,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.slicedMedia,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["position-relative",m.col]),key:t.path,onClick:(0,n.iM)((t=>m.showPostMedia(e)),["prevent"])},[(0,a._)("img",{src:t.path,alt:"post-image",class:"rounded w-100 h-100 post-image",style:{"object-fit":"cover"}},null,8,c),m.post.media?.length>m.slicedMedia.length&&e===m.slicedMedia.length-1?((0,a.wg)(),(0,a.iD)("div",p,[u,(0,a._)("span",null,(0,o.zw)(m.post.media?.length-m.slicedMedia.length),1),g])):(0,a.kq)("",!0)],10,d)))),128))])])):(0,a.kq)("",!0),(0,a.Wm)(y,{ref:"postMediaModal"},null,512)],64)}const m={href:"javascript:void(0);",class:"lh-1","data-bs-dismiss":"modal",ref:"galleryModalCloseBtn"},y=(0,a._)("span",{class:"material-symbols-outlined"},"close",-1),w=[y],f={class:"col-12"},_=["id"],v={class:"carousel-indicators"},b=["data-bs-target","data-bs-slide-to","aria-current","aria-label"],k={class:"carousel-inner h-100"},P={class:"d-flex justify-content-center align-items-center h-100"},M=["href"],C=["src","alt"],x=["data-bs-target"],D=(0,a._)("span",{class:"carousel-control-prev-icon","aria-hidden":"true"},null,-1),$=(0,a._)("span",{class:"visually-hidden"},"Previous",-1),T=[D,$],O=["data-bs-target"],S=(0,a._)("span",{class:"carousel-control-next-icon","aria-hidden":"true"},null,-1),Z=(0,a._)("span",{class:"visually-hidden"},"Next",-1),I=[S,Z];function U(t,e,s,n,i,r){const l=(0,a.up)("model-header"),d=(0,a.up)("model-body"),c=(0,a.up)("modal");return(0,a.wg)(),(0,a.j4)(c,{ref:"galleryModalRef",id:`galleryModal-${r.post.id}`,dialogClass:"modal-lg modal-dialog-centered",tabindex:"-1","aria-labelledby":`galleryModalLabel-${r.post.id}`,"aria-hidden":!0},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a._)("a",m,w,512)])),_:1}),(0,a.Wm)(d,{style:{"background-color":"#eee"}},{default:(0,a.w5)((()=>[(0,a._)("div",f,[(0,a._)("div",{id:`gallery-${r.post.id}`,class:"carousel slide carousel-dark","data-bs-ride":"carousel",style:{height:"60vh"}},[(0,a._)("div",v,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.post.media,((t,e)=>((0,a.wg)(),(0,a.iD)("button",{key:t.id,type:"button","data-bs-target":`#gallery-${r.post.id}`,"data-bs-slide-to":e,"aria-current":e===i.currentMediaIndex,"aria-label":`Slide ${e+1}`,class:(0,o.C_)({active:e===i.currentMediaIndex})},null,10,b)))),128))]),(0,a._)("div",k,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.post.media,((t,e)=>((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["carousel-item mx-auto h-100",{active:e===i.currentMediaIndex}]),key:t.id},[(0,a._)("div",P,[(0,a._)("a",{href:t.path,target:"_blank"},[(0,a._)("img",{src:t.path,class:"d-block h-100 img-fluid",alt:`Post Image ${e+1}`},null,8,C)],8,M)])],2)))),128))]),(0,a._)("button",{class:"carousel-control-prev",type:"button","data-bs-target":`#gallery-${r.post.id}`,"data-bs-slide":"next"},T,8,x),(0,a._)("button",{class:"carousel-control-next",type:"button","data-bs-target":`#gallery-${r.post.id}`,"data-bs-slide":"prev"},I,8,O)],8,_)])])),_:1})])),_:1},8,["id","aria-labelledby"])}var F=s(79909),z={name:"PostMediaModal",inject:["post"],data(){return{galleryModal:null,currentMediaIndex:0}},mounted(){this.galleryModal=new F.u_(this.$refs.galleryModalRef.$el)},methods:{showPostMedia(t){this.galleryModal.show(),this.currentMediaIndex=t}}},q=s(83744);const B=(0,q.Z)(z,[["render",U]]);var j=B,H={name:"PostMedia",components:{PostMediaModal:j},inject:["post"],computed:{col(){return this.post.media.length>1?"col-6":"col-12"},slicedMedia(){return this.post.media?this.post.media.slice(0,4):[]}},methods:{showPostMedia(t){this.$refs.postMediaModal.showPostMedia(t)}}};const L=(0,q.Z)(H,[["render",h],["__scopeId","data-v-881e41a6"]]);var Y=L},3416:function(t,e,s){s.d(e,{Z:function(){return x}});var a=s(66252),o=s(3577),n=s(49963);const i={class:"user-post-data"},r={class:"d-flex justify-content-between"},l={class:"d-flex align-items-center"},d={key:0,class:"material-symbols-outlined ms-1"},c={key:1,class:"ms-1 text-danger"},p={key:0,class:"card-post-toolbar"},u=(0,a._)("span",{class:"material-symbols-outlined"}," more_horiz ",-1),g=[u],h=(0,a._)("span",{class:"material-symbols-outlined me-2 md-18"}," push_pin ",-1),m={class:"material-symbols-outlined me-2 md-18"},y=["aria-disabled"],w=(0,a._)("span",{class:"material-symbols-outlined me-2 md-18"}," delete ",-1),f=(0,a._)("span",{class:"material-symbols-outlined me-2 md-18"}," cancel ",-1);function _(t,e,s,u,_,v){const b=(0,a.up)("tooltip"),k=(0,a.up)("PostUser");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a._)("div",r,[(0,a.Wm)(k,{post:v.post},{date:(0,a.w5)((()=>[(0,a._)("div",l,[(0,a.Wm)(b,{tag:"p",class:"mb-0 text-primary",tooltipPlacement:"bottom","data-bs-toggle":"tooltip",title:t.formatFullDate(v.post.created_at),style:{width:"fit-content"},onClick:v.sendToPostPage},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(t.formatDateToWritten(v.post.created_at)),1)])),_:1},8,["title","onClick"]),v.post.is_pinned?((0,a.wg)(),(0,a.iD)("span",d," push_pin ")):(0,a.kq)("",!0),"announcement"===v.post.type.toLowerCase()?((0,a.wg)(),(0,a.iD)("span",c,"إعلان")):(0,a.kq)("",!0)])])),_:1},8,["post"]),v.byAuth?((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",{class:"dropdown-toggle",id:"dropdownMenuButton","data-bs-toggle":"dropdown","aria-expanded":"false",role:"button",onClick:e[0]||(e[0]=t=>_.show=!_.show)},g),(0,a._)("div",{class:(0,o.C_)("dropdown-menu dropdown-menu-right "+(_.show?"show":"")),"aria-labelledby":"dropdownMenuButton",style:{}},[s.showPin?((0,a.wg)(),(0,a.iD)("a",{key:0,class:"dropdown-item d-flex align-items-center text-primary",href:"#",onClick:e[1]||(e[1]=(0,n.iM)(((...t)=>v.pin&&v.pin(...t)),["prevent"]))},[h,(0,a.Uk)(" "+(0,o.zw)(v.post.is_pinned?"فك التثبيت":"تثبيت"),1)])):(0,a.kq)("",!0),(0,a._)("a",{class:"dropdown-item d-flex align-items-center text-primary",href:"#",onClick:e[2]||(e[2]=(0,n.iM)(((...t)=>v.closeComments&&v.closeComments(...t)),["prevent"]))},[(0,a._)("span",m,(0,o.zw)(v.post.allow_comments?"comments_disabled":"comment"),1),(0,a.Uk)(" "+(0,o.zw)(v.post.allow_comments?"إغلاق":"فتح")+" التعليقات ",1)]),(0,a._)("a",{class:"dropdown-item d-flex align-items-center",href:"#",role:"button","aria-disabled":_.deleteLoading,onClick:e[3]||(e[3]=(0,n.iM)(((...t)=>v.deletePost&&v.deletePost(...t)),["prevent"]))},[w,(0,a.Uk)("حذف")],8,y),(0,a._)("a",{class:"dropdown-item d-flex align-items-center",href:"#",onClick:e[4]||(e[4]=(0,n.iM)((t=>_.show=!1),["prevent"]))},[f,(0,a.Uk)("إغلاق")])],2)])):(0,a.kq)("",!0)])])}s(57658);var v=s(8209),b=s(27010),k=s(8417),P={name:"PostHeader",inject:{closePostComments:{default:()=>{}},pinPost:{default:()=>{}},postDelete:{default:()=>{}},post:{required:!0}},components:{PostUser:b.Z},props:{showPin:{type:Boolean,default:!1}},data(){return{show:!1,deleteLoading:!1}},computed:{byAuth(){return this.post.user.id===this.$store.getters.getUser.id}},methods:{...v.Z,async closeComments(){try{await k.Z.contolComments(this.post.id),this.closePostComments(this.post.id),this.post.allow_comments?this.toggleToast("تم فتح التعليقات","success"):this.toggleToast("تم إغلاق التعليقات","success")}catch(t){this.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}},async pin(){try{const t=await k.Z.pinPost(this.post.id);if(200!==t.statusCode)return void this.toggleToast("حدث خطأ ما, حاول مرة أخرى","error");const e="pinned"===t.data;this.pinPost(this.post.id,e),e?this.toggleToast("تم تثبيت المنشور","success"):this.toggleToast("تم فك التثبيت","success")}catch(t){this.toggleToast("حدث خطأ ما, حاول مرة أخرى","error")}},async deletePost(){if(this.deleteLoading)return;const t=this.$swal.mixin({customClass:{confirmButton:"btn btn-primary btn-lg",cancelButton:"btn btn-outline-danger btn-lg ms-2"},buttonsStyling:!1});t.fire({title:"هل أنت متأكد؟",text:"سيتم حذف هذا المنشور نهائياً!",icon:"warning",showCancelButton:!0,confirmButtonText:"نعم, احذف!",cancelButtonText:"تراجع",showClass:{popup:"animate__animated animate__zoomIn"},hideClass:{popup:"animate__animated animate__zoomOut"}}).then((async t=>{if(t.isConfirmed){this.deleteLoading=!0;try{await k.Z["delete"](this.post.id),this.postDelete(this.post.id),v.Z.handleSuccessSwal("تم حذف المنشور بنجاح")}catch(e){v.Z.handleErrorSwal("حدث خطأ أثناء الحذف, يرجى المحاولة مرة أخرى!")}finally{this.deleteLoading=!1}}}))},sendToPostPage(){this.post.is_approved?this.$router.push({name:"osboha.post",params:{post_id:this.post.id}}):this.$router.push({name:"osboha.pendingPosts",params:{timeline_id:this.post.timeline.id,post_id:this.post.id}})}}},M=s(83744);const C=(0,M.Z)(P,[["render",_]]);var x=C},27010:function(t,e,s){s.d(e,{Z:function(){return f}});var a=s(66252),o=s(3577),n=s(49963);const i=t=>((0,a.dD)("data-v-95a6144a"),t=t(),(0,a.Cn)(),t),r={class:"mx-2 flex-grow-1"},l={class:"author-friends p-0 m-0"},d={class:"mx-1"},c=i((()=>(0,a._)("span",{class:"mx-1"}," مع ",-1))),p=["onClick"],u={key:0,class:"mx-1"},g={key:1};function h(t,e,s,i,h,m){const y=(0,a.up)("BaseAvatar");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(y,{profileImg:m.userProfile?.profile_picture,profile_id:m.userProfile?.id,title:s.post.user?.name,gender:s.post.user?.gender,avatarClass:"avatar-50 rounded-circle"},null,8,["profileImg","profile_id","title","gender"]),(0,a._)("div",r,[(0,a._)("div",l,[(0,a._)("span",{class:(0,o.C_)(["author-name",{"hover-undelined":m.authUser.id!=s.post.user?.id}]),role:"button",onClick:e[0]||(e[0]=(0,n.iM)((t=>m.authUser.id!=s.post.user?.id?m.sendToProfile(s.post.user?.id):null),["prevent"]))},(0,o.zw)(s.post.user?.name),3),s.post.timeline&&(s.post.timeline.user&&s.post.timeline.user.id!=s.post.user?.id||s.post.timeline.group)?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("span",d,(0,o.zw)(s.post.timeline.user?"عند":"في"),1),s.post.timeline.user&&s.post.timeline.user.id!=s.post.user?.id?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"author-name hover-undelined",role:"button",onClick:e[1]||(e[1]=(0,n.iM)((t=>m.sendToProfile(s.post.timeline?.user?.id)),["prevent"]))},(0,o.zw)(s.post.timeline.user.name??""),1)):s.post.timeline.group?((0,a.wg)(),(0,a.iD)("span",{key:1,class:"author-name hover-undelined",role:"button",onClick:e[2]||(e[2]=(0,n.iM)((t=>m.sendToGroup(s.post.timeline.group.id)),["prevent"]))},(0,o.zw)(s.post.timeline.group.name??""),1)):(0,a.kq)("",!0)],64)):(0,a.kq)("",!0),s.post.taggedUsers?.length?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[c,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(m.slicedTaggedFriends,((i,r)=>((0,a.wg)(),(0,a.iD)("span",{key:i.id},[(0,a._)("span",{class:"author-name hover-undelined",role:"button",onClick:(0,n.iM)((t=>m.sendToProfile(i.user.id)),["prevent"])},(0,o.zw)(i.user?.name??""),9,p),r!==m.slicedTaggedFriends.length-1||s.post.taggedUsers?.length>m.slicedTaggedFriends.length?((0,a.wg)(),(0,a.iD)("span",u,"و")):(0,a.kq)("",!0),r===m.slicedTaggedFriends.length-1?((0,a.wg)(),(0,a.iD)("span",g,[s.post.taggedUsers?.length>m.slicedTaggedFriends.length?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"author-name hover-undelined",role:"button",onClick:e[3]||(e[3]=(0,n.iM)(((...e)=>t.getFriends&&t.getFriends(...e)),["prevent"]))},(0,o.zw)(s.post.taggedUsers?.length-m.slicedTaggedFriends.length)+" أكثر",1)):(0,a.kq)("",!0)])):(0,a.kq)("",!0)])))),128))],64)):(0,a.kq)("",!0)]),(0,a.WI)(t.$slots,"date",{},void 0,!0)])],64)}s(57658);var m={name:"PostUser",props:{post:{type:Object,required:!0}},computed:{slicedTaggedFriends(){return this.post.taggedUsers?.slice(0,3)},profile_picture(){const t=s(29822),e=s(48934),a=this.post.user?.gender?.toLowerCase();return"female"===a?t:e},authUser(){return this.$store.getters.getUser},userProfile(){return this.post?.user?.profile??this.post?.user?.user_profile}},methods:{sendToProfile(t){this.$router.push({name:"user.profile",params:{user_id:t}})},sendToGroup(t){this.$router.push({name:"group.group-detail",params:{group_id:t}})}}},y=s(83744);const w=(0,y.Z)(m,[["render",h],["__scopeId","data-v-95a6144a"]]);var f=w},29822:function(t,e,s){t.exports=s.p+"img/avatar-04.f7603e1d.jpg"},48934:function(t,e,s){t.exports=s.p+"img/avatar-05.5d33d3c7.jpg"}}]);
//# sourceMappingURL=3272.ff7a6176.js.map