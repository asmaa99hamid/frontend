{"version":3,"file":"js/6082.792134e9.js","mappings":"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","sources":["webpack://Osboha180/./src/API/services/notifications.service.js","webpack://Osboha180/./src/views/OsbohaMain/Notifications/Notification.vue","webpack://Osboha180/./src/views/OsbohaMain/Notifications/Notification.vue?d665"],"sourcesContent":["import { handleError } from \"vue\";\r\nimport { api } from \"../Intercepter\";\r\n\r\nclass Notifications {\r\n  constructor() {\r\n    this.prefix = \"notifications\";\r\n  }\r\n\r\n  /**\r\n   * list all Unread Notifications.\r\n   * @return Unread Notifications\r\n   */\r\n  async listUnreadNotification() {\r\n    try {\r\n      const response = await api.get(`${this.prefix}/un-read`);\r\n      return response.data.data;\r\n    } catch (error) {\r\n      handleError(error);\r\n    }\r\n  }\r\n  /**\r\n   * list all Notifications.\r\n   * @return Unread Notifications\r\n   */\r\n  async listAllNotification(page) {\r\n    try {\r\n      const response = await api.get(`${this.prefix}/list-all?page=${page}`);\r\n      return response.data.data;\r\n    } catch (error) {\r\n      handleError(error);\r\n    }\r\n  }\r\n  /**\r\n   * mark one notification as read\r\n   * @param notification_id\r\n   */\r\n  async markAsRead(notification_id) {\r\n    try {\r\n      const response = await api.get(\r\n        `${this.prefix}/mark-as-read/${notification_id}`\r\n      );\r\n      return response.data.data;\r\n    } catch (error) {\r\n      return error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * mark ALL notifications as read\r\n   * @param notification_id\r\n   */\r\n  async markAllAsRead() {\r\n    try {\r\n      const response = await api.get(`${this.prefix}/mark-all-as-read`);\r\n      return response.data.data;\r\n    } catch (error) {\r\n      return error;\r\n    }\r\n  }\r\n}\r\n\r\nexport default new Notifications();\r\n","<template>\r\n  <div class=\"row\" ref=\"listContainer\">\r\n    <div class=\"col-sm-12\">\r\n      <h4 class=\"card-title\">الاشعارات</h4>\r\n\r\n      <div class=\"col-sm-12\" v-if=\"notifications.length == 0\">\r\n        <iq-card class=\"iq-card\">\r\n          <div class=\"iq-card-body p-0\">\r\n            <div class=\"image-block text-center\">\r\n              <img\r\n                src=\"@/assets/images/main/no-notifications.png\"\r\n                class=\"img-fluid rounded w-50\"\r\n                alt=\"blog-img\"\r\n              />\r\n            </div>\r\n\r\n            <h4 class=\"text-center mt-3 mb-3\">لا يوجد اشعارات</h4>\r\n          </div>\r\n        </iq-card>\r\n      </div>\r\n\r\n      <span\r\n        role=\"button\"\r\n        class=\"btn btn-primary mb-3\"\r\n        v-if=\"unreadCount > 0\"\r\n        style=\"direction: rtl !important\"\r\n        @click=\"markAllAsRead()\"\r\n      >\r\n        <i role=\"button\" class=\"material-symbols-outlined align-middle\">\r\n          done\r\n        </i>\r\n\r\n        تحديد قراءة الكل\r\n      </span>\r\n    </div>\r\n    <div\r\n      class=\"col-sm-12\"\r\n      v-for=\"(notification, index) in notifications\"\r\n      :key=\"index\"\r\n    >\r\n      <iq-card :class=\"seenClass(notification.read_at)\">\r\n        <template v-slot:body>\r\n          <div class=\"notification-list m-0 p-0\">\r\n            <div class=\"d-flex align-items-center justify-content-between\">\r\n              <base-avatar\r\n                :profileImg=\"\r\n                  notification.data.sender.user_profile.profile_picture\r\n                \"\r\n                :profile_id=\"notification.data.sender.user_profile.id\"\r\n                :title=\"notification.data.sender.name\"\r\n                :gender=\"notification.data.sender.gender\"\r\n                avatarClass=\"rounded-circle avatar-40\"\r\n              />\r\n              <div class=\"w-100\">\r\n                <div class=\"d-flex justify-content-between\">\r\n                  <div class=\"ms-3\">\r\n                    <h6>{{ notification.data.message }}</h6>\r\n                    <tooltip\r\n                      tag=\"span\"\r\n                      class=\"text-muted small\"\r\n                      tooltipPlacement=\"bottom\"\r\n                      data-bs-toggle=\"tooltip\"\r\n                      :title=\"formatFullDate(notification.created_at)\"\r\n                      >{{ formatDateToWritten(notification.created_at) }}\r\n                    </tooltip>\r\n                  </div>\r\n\r\n                  <div class=\"d-flex align-items-center\">\r\n                    <span\r\n                      role=\"button\"\r\n                      class=\"me-1\"\r\n                      @click.prevent=\"\r\n                        sendToPage(notification.data.path, notification.id)\r\n                      \"\r\n                      v-if=\"notification.data.path\"\r\n                    >\r\n                      عرض\r\n                    </span>\r\n                    <i\r\n                      role=\"button\"\r\n                      class=\"material-symbols-outlined md-18 me-3\"\r\n                      v-if=\"!notification.read_at\"\r\n                      @click=\"markAsRead(notification.id)\"\r\n                    >\r\n                      done\r\n                    </i>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </template>\r\n      </iq-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport helper from \"@/utilities/helper\";\r\nimport notificationsServices from \"@/API/services/notifications.service\";\r\n\r\nexport default {\r\n  name: \"Notification\",\r\n  created() {\r\n    this.loadNotifications();\r\n  },\r\n  async mounted() {\r\n    window.addEventListener(\"scroll\", this.handleScroll);\r\n  },\r\n  beforeUnmount() {\r\n    window.removeEventListener(\"scroll\", this.handleScroll);\r\n  },\r\n  data() {\r\n    return {\r\n      notifications: [],\r\n      notifications_route: [],\r\n      notification_route: {\r\n        friends_requests: \"user.friendsRequests\",\r\n      },\r\n\r\n      page: 1,\r\n      totalPages: 1,\r\n      loading: false,\r\n      pendingRequest: false,\r\n      hasMore: true,\r\n      unRead: false,\r\n    };\r\n  },\r\n  computed: {\r\n    hasMoreToLoad() {\r\n      return this.page <= this.totalPages && this.hasMore;\r\n    },\r\n    unreadCount() {\r\n      return this.$store.state.unreadNotifications;\r\n    },\r\n  },\r\n  methods: {\r\n    ...helper,\r\n    async loadNotifications() {\r\n      if (this.pendingRequest) {\r\n        return;\r\n      }\r\n\r\n      this.pendingRequest = true;\r\n      this.loading = true;\r\n      try {\r\n        let response = await notificationsServices.listAllNotification(\r\n          this.page\r\n        );\r\n        this.notifications = response.data;\r\n\r\n        this.checkUnread();\r\n\r\n        this.totalPages = response.data?.last_page ?? 1;\r\n        this.page++;\r\n\r\n        if (response.statusCode === 200 && !response.data) {\r\n          this.hasMore = false;\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        console.log(error);\r\n        // helper.toggleToast(\r\n        //   \"حدث خطأ أثناء تحميل الإشعارات, حاول مرة أخرى\",\r\n        //   \"error\"\r\n        // );\r\n      } finally {\r\n        this.loading = false;\r\n        this.pendingRequest = false;\r\n      }\r\n    },\r\n    /**\r\n     * Check if the user has scrolled to the bottom of the page\r\n     * @returns {boolean}\r\n     */\r\n    isAtBottomOfPage() {\r\n      const containerRect = this.$refs.listContainer.getBoundingClientRect();\r\n      const containerBottom = containerRect.bottom;\r\n      const windowHeight = window.innerHeight;\r\n      return containerBottom <= windowHeight;\r\n    },\r\n    /*\r\n     * Load more posts when the user scrolls to the bottom of the page\r\n     */\r\n    handleScroll() {\r\n      if (this.hasMoreToLoad && this.isAtBottomOfPage()) {\r\n        this.loadNotifications();\r\n      }\r\n    },\r\n\r\n    /**\r\n     * return bg color class.\r\n     *  @param  read_at\r\n     * @return class\r\n     */\r\n    seenClass(read_at) {\r\n      if (read_at) {\r\n        return \"seen\";\r\n      } else {\r\n        return \"un-seen\";\r\n      }\r\n    },\r\n    /**\r\n     * mark one notification as read.\r\n     *  @param  notification_id\r\n     */\r\n    async markAsRead(notification_id) {\r\n      const response = await notificationsServices.markAsRead(notification_id);\r\n      this.notifications = response.data;\r\n      this.checkUnread();\r\n      if (this.unreadCount > 0) {\r\n        this.$store.commit(\"SET_UNREAD_NOTIFICATIONS\", this.unreadCount - 1);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * mark ALL notification as read.\r\n     */\r\n    async markAllAsRead() {\r\n      const response = await notificationsServices.markAllAsRead();\r\n      this.notifications = response.data;\r\n      this.checkUnread();\r\n      this.$store.commit(\"SET_UNREAD_NOTIFICATIONS\", 0);\r\n    },\r\n    checkUnread() {\r\n      function there_is_unread(notification) {\r\n        return notification.read_at === null;\r\n      }\r\n      // check unread\r\n      if (this.notifications.find(there_is_unread)) {\r\n        this.unRead = true;\r\n      }\r\n    },\r\n\r\n    sendToPage(path, id) {\r\n      if (path) {\r\n        this.$router.push({ path });\r\n      }\r\n      this.markAsRead(id);\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.seen {\r\n  --bs-bg-opacity: 1;\r\n  background-color: white;\r\n}\r\n\r\n.un-seen {\r\n  --bs-bg-opacity: 1;\r\n  background-color: #e2e2e2;\r\n}\r\n</style>\r\n","import { render } from \"./Notification.vue?vue&type=template&id=00ccf405&scoped=true\"\nimport script from \"./Notification.vue?vue&type=script&lang=js\"\nexport * from \"./Notification.vue?vue&type=script&lang=js\"\n\nimport \"./Notification.vue?vue&type=style&index=0&id=00ccf405&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\Asmaa\\\\osboha\\\\Osboha2022-frontend\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-00ccf405\"]])\n\nexport default __exports__"],"names":["Notifications","constructor","this","prefix","async","response","api","data","error","handleError","page","notification_id","class","ref","_createElementVNode","src","_imports_0","alt","role","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","$data","notifications","length","_hoisted_4","_createVNode","_component_iq_card","_hoisted_5","$options","unreadCount","style","onClick","_cache","$event","markAllAsRead","_hoisted_6","_Fragment","_renderList","notification","index","key","_normalizeClass","seenClass","read_at","body","_withCtx","_hoisted_7","_hoisted_8","_component_base_avatar","profileImg","sender","user_profile","profile_picture","profile_id","id","title","name","gender","avatarClass","_hoisted_9","_hoisted_10","_hoisted_11","_toDisplayString","message","_component_tooltip","tag","tooltipPlacement","_ctx","formatFullDate","created_at","formatDateToWritten","_hoisted_12","path","_withModifiers","sendToPage","_hoisted_13","markAsRead","_hoisted_14","created","loadNotifications","window","addEventListener","handleScroll","beforeUnmount","removeEventListener","notifications_route","notification_route","friends_requests","totalPages","loading","pendingRequest","hasMore","unRead","computed","hasMoreToLoad","$store","state","unreadNotifications","methods","helper","notificationsServices","checkUnread","last_page","statusCode","console","log","isAtBottomOfPage","containerRect","$refs","listContainer","getBoundingClientRect","containerBottom","bottom","windowHeight","innerHeight","commit","there_is_unread","find","$router","push","__exports__","render"],"sourceRoot":""}